/*
  filename: angular.integralui.treeview.min.js
  version : 2.1.010
  Copyright ï¿½ 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeViewService",["$rootScope",function(d){var l=null;return{addItem:function(e,k,g){d.$broadcast(e+"-add-item",k,g)},clearItems:function(e,k){d.$broadcast(e+"-clear-items",k)},insertItemAt:function(e,k,g,l){d.$broadcast(e+"-insert-item-at",k,g,l)},insertItemBefore:function(e,k,g){d.$broadcast(e+"-insert-item-before",k,g)},insertItemAfter:function(e,k,g){d.$broadcast(e+"-insert-item-after",k,g)},removeItem:function(e,k){d.$broadcast(e+"-remove-item",k)},removeItemAt:function(e,k,g){d.$broadcast(e+"-remove-item-at",k,g)},exportToJSON:function(e,k,g,l){d.$broadcast(e+"-export-json",k,g,l);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,k,g,l,h){d.$broadcast(e+"-load-data",k,g,l,h)},beginLoad:function(e,k){d.$broadcast(e+"-begin-load",k)},collapse:function(e,k){d.$broadcast(e+"-collapse",k)},endLoad:function(e){d.$broadcast(e+"-end-load")},expand:function(e,k){d.$broadcast(e+"-expand",k)},toggle:function(e,k){d.$broadcast(e+"-toggle",k)},findItemById:function(e,k){d.$broadcast(e+"-find-item-by-id",k);var g=this.getTempData();this.clearTempData();return g?g:null},findItemByText:function(e,k){d.$broadcast(e+"-find-item-by-text",k);var g=this.getTempData();this.clearTempData();return g?g:null},getItemParent:function(e,k){d.$broadcast(e+"-get-item-parent",k);var g=this.getTempData();this.clearTempData();return g?g:null},filter:function(e,k){d.$broadcast(e+"-filter",k)},focus:function(e,k){d.$broadcast(e+"-focus",k)},clearTempData:function(){l=null},ensureVisible:function(e,k,g){d.$broadcast(e+"-ensure-visible",k,g)},getCheckList:function(e,k){d.$broadcast(e+"-get-check-list",k);var g=this.getTempData();this.clearTempData();return g?g:[]},getItemLevel:function(e,k){d.$broadcast(e+"-get-item-level",k);var g=this.getTempData();this.clearTempData();return g?g:0},getFlatList:function(e,k){d.$broadcast(e+"-get-flat-list",k);var g=this.getTempData();this.clearTempData();return g?g:[]},getFullPath:function(e,k){d.$broadcast(e+"-get-full-path",k);var g=this.getTempData();this.clearTempData();return g?g:""},getList:function(e,k,g){d.$broadcast(e+"-get-list",k,g);e=this.getTempData();this.clearTempData();return e?e:[]},getTempData:function(){return l},setTempData:function(d){l=d},selectedItem:function(e,k){if(k)d.$broadcast(e+"-set-selected-item",k);else{d.$broadcast(e+"-get-selected-item");var g=this.getTempData();this.clearTempData();return g?g:null}},selectedItems:function(e){d.$broadcast(e+"-get-selected-items");e=this.getTempData();this.clearTempData();return e?e:null},getScrollPos:function(e){d.$broadcast(e+"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,k){d.$broadcast(e+"-set-scroll-pos",k)},scrollTo:function(e,k,g){d.$broadcast(e+"-scroll-to",k,g)},sort:function(e,k,g){d.$broadcast(e+"-sort",k,g)},updateCheckValues:function(e,k){d.$broadcast(e+"-update-check",k)},refresh:function(e,k,g){d.$broadcast(e+"-refresh",k,g)},resumeLayout:function(e){d.$broadcast(e+"-resume-layout")},suspendLayout:function(e){d.$broadcast(e+"-suspend-layout")},updateLayout:function(e){d.$broadcast(e+"-update-layout")},updateView:function(e){d.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeViewController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeViewService","IntegralUIDragDrop","IntegralUIFilter",function(d,l,e,k,g,D,h,n,ea){var a=this;a.hoverItem=null;this.suppressProcess=!1;a.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};a.defaultStyle={general:"iui-treeview",item:{general:{disabled:"iui-treeview-item-disabled",focused:"iui-treeview-item-focused",normal:"iui-treeview-item",hovered:"iui-treeview-item-hovered",selected:"iui-treeview-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treeview-expand-box",animated:"iui-treeview-expand-box-load",expanded:"iui-treeview-expand-box-open",collapsed:"iui-treeview-expand-box-close"},content:{disabled:"iui-treeview-item-content-disabled",focused:"iui-treeview-item-content-focused",normal:"iui-treeview-item-content",hovered:"iui-treeview-item-content-hovered",selected:"iui-treeview-item-content-selected"}}};a.defaultCheckBoxSettings={autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1};a.options={allowAnimation:!0,allowDrag:!1,allowDrop:!0,allowFocus:!0,animationSpeed:200,autoCheck:!1,autoExpand:!0,checkBoxSettings:a.defaultCheckBoxSettings,controlStyle:a.defaultStyle,dataFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",dataSource:null,enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",style:"style",text:"text",value:"value"},editorSettings:{activate:"click"},hoverSelection:!1,indent:15,itemIcon:"",itemSpacing:1,labelEdit:!1,loadItem:null,pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,selectedItems:[],selectionMode:"one",showCheckBoxes:!1,showIcons:!0,showStatusIcons:!1,sorting:"none"};d.$on(d.name+"-add-item",function(b,c,d){a.dataObj.insertAt(c,-1,d,a.itemIsAdded)});d.$on(d.name+"-clear-items",function(b,c){a.dataObj.clear(c,a.itemIsRemoved);c||a.setScrollPos({x:0,y:0})});d.$on(d.name+"-insert-item-at",function(b,c,d,f){a.dataObj.insertAt(c,d,f,a.itemIsAdded)});d.$on(d.name+"-insert-item-after",function(b,c,d){a.dataObj.insertByRef(c,d,!0,a.itemIsAdded)});d.$on(d.name+"-insert-item-before",function(b,c,d){a.dataObj.insertByRef(c,d,!1,a.itemIsAdded)});d.$on(d.name+"-remove-item",function(b,c){a.dataObj.removeAt(c,-1,null,a.itemIsRemoved)});d.$on(d.name+"-remove-item-at",function(b,c,d){a.dataObj.removeAt(null,c,d,a.itemIsRemoved)});this.itemIsAdded=function(){a.updateLayout()};this.itemIsRemoved=function(b,c,d){a.updateLayout()};this.objIsRemoved=function(b,c,d){a.updateLayout()};this.getCheckValue=function(b){return"checked"==b[a.options.dataFields.checkState]?"checked":1==a.options.checkBoxSettings.threeState&&"indeterminate"==b[a.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(b){if(1==a.options.autoCheck||1==a.options.checkBoxSettings.autoCheck){var c=a.getCheckValue(b),m=!1,m=1==a.options.checkBoxSettings.threeState?a.callCheckValueChanging(b,c):a.callCheckValueChanging(b,"checked"==c?!0:!1);if(!1!==m){if(1==a.options.checkBoxSettings.threeState)switch(c){case "checked":c="unchecked";break;case "indeterminate":c="checked";break;case "unchecked":c="indeterminate"}else c="unchecked"==c||"indeterminate"==c?"checked":"unchecked";b[a.options.dataFields.checkState]=c;b[a.options.dataFields.checked]="checked"==c?!0:!1;d.$apply()}}};this.callCheckValueChanging=function(b,c){var m=!0;a.allowEvents&&(m=1==a.options.checkBoxSettings.threeState?angular.isDefined(d.events)&&d.events.itemCheckstateChanging?d.events.itemCheckstateChanging({item:b,value:c}):d.itemCheckstateChanging({e:{item:b,value:c}}):angular.isDefined(d.events)&&d.events.itemCheckedChanging?d.events.itemCheckedChanging({item:b,value:c}):d.itemCheckedChanging({e:{item:b,value:c}}));return m};this.callCheckValueChanged=function(b,c){a.allowEvents&&(retValue=1==a.options.checkBoxSettings.threeState?angular.isDefined(d.events)&&d.events.itemCheckstateChanged?d.events.itemCheckstateChanged({item:b,value:c}):d.itemCheckstateChanged({e:{item:b,value:c}}):angular.isDefined(d.events)&&d.events.itemCheckedChanged?d.events.itemCheckedChanged({item:b,value:c}):d.itemCheckedChanged({e:{item:b,value:c}}))};var G=[],p=!1;this.fillCheckList=function(b){if(b&&1==a.options.checkBoxSettings.threeState&&!p){p=!0;G.length=0;G.push({item:b,value:b[a.options.dataFields.checkState]});a.updateListChildItemCheckValue(b);a.updateListParentItemCheckValue(b);for(var c=0,c=0;c<G.length;c++)G[c].item[a.options.dataFields.checkState]=G[c].value;var d=e(function(){c==G.length&&(p=!1);e.cancel(d)},1)}};this.getItemCheckValue=function(b){for(var c="unchecked",d=!1,f=0;f<G.length;f++)if(G[f].item==b){d=!0;c=G[f].value;break}d||(c=b[a.options.dataFields.checkState]);return c};this.updateListParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var c=b[a.options.dataFields.items];if(c){for(var d=0,f=0,g=0;g<c.length;g++){var e=a.getItemCheckValue(c[g]);"checked"==e?d++:"indeterminate"==e&&f++}g={item:b};g.value=d==c.length?"checked":0<d||0<f?"indeterminate":"unchecked";G.push(g)}b=a.getParent(b)}};this.updateListChildItemCheckValue=function(b){if(b){var c=b[a.options.dataFields.items];if(c)for(var d=0;d<c.length;d++){var f={item:c[d]};"checked"==a.getItemCheckValue(b)?f.value="checked":f.value="unchecked";G.push(f);a.updateListChildItemCheckValue(c[d])}}};this.updateParentItemCheckValue=function(b){for(b=a.getParent(b);b;){var c=b[a.options.dataFields.items];if(c){for(var d=0,f=0,g=0;g<c.length;g++)"checked"==c[g][a.options.dataFields.checkState]?d++:"indeterminate"==c[g][a.options.dataFields.checkState]&&f++;b[a.options.dataFields.checkState]=d==c.length?"checked":0<d||0<f?"indeterminate":"unchecked"}b=a.getParent(b)}};this.updateItemCheckValue=function(b,c){if("checked"==c||"unchecked"==c)b[a.options.dataFields.checkState]=c;var d=b[a.options.dataFields.items];if(d&&0<d.length)for(var f=0;f<d.length;f++)a.updateItemCheckValue(d[f],b[a.options.dataFields.checkState]);void 0!=b[a.options.dataFields.checkState]&&(d=a.getParent(b))&&d[a.options.dataFields.checkState]!=b[a.options.dataFields.checkState]&&a.updateParentItemCheckValue(b)};this.updateCheckValues=function(b){if(1==a.options.checkBoxSettings.threeState){b=a.dataObj.getList(b);for(var c=0;c<b.length;c++)a.updateItemCheckValue(b[c])}};d.$on(d.name+"-update-check",function(b,c){a.updateCheckValues(c)});d.$on(d.name+"-get-check-list",function(b,c){a.updateCheckValues();void 0==c&&(c=1==a.options.checkBoxSettings.threeState?"checked":!0);var d=1==a.options.checkBoxSettings.threeState?a.options.dataFields.checkState:a.options.dataFields.checked,f={operation:"=",value:c},d=ea.filter(a.getFullList(),d,f);h.setTempData(d)});this.updateCheckBoxSettings=function(b){a.options.checkBoxSettings=b?{autoCheck:g.isFieldAvailable(b.autoCheck,!1),style:B(b.style),threeState:g.isFieldAvailable(b.threeState,!1)}:{autoCheck:!1,style:a.defaultCheckBoxStyle,threeState:!1}};var y=function(a){return a?ea.createTree(a.conditions,a.formula):null},v=function(b){var c=!0;b&&a.filterParams&&(c=(c=b[a.options.dataFields.value])?c:b[a.options.dataFields.text],c=a.filterParams.callback?a.filterParams.callback(c,b):ea.match(c,a.filterParams.conditions,a.filterParams.formula,y(a.filterParams)));return c},t=a.options.indent,J=0;a.currentList=[];a.indentList=[];a.longestItem=null;a.isThereChildItems=!1;var I=function(b,c,d,f){b.type="item";b[a.options.dataFields.id]||(b[a.options.dataFields.id]=g.getUniqueId());d&&(b[a.options.dataFields.pid]=d);if(d=v(b))f?a.fullList.push(b):(a.currentList.push(b),a.indentList.push(c),b[a.options.dataFields.text]&&(c=b[a.options.dataFields.text].length+c/t,J<c&&(J=c,a.longestItem=b)));return d};this.isThereVisibleChildren=function(b){var c=!1;if(b&&(b=b[a.options.dataFields.items]))for(var d=0;d<b.length;d++)if(v(b[d])){c=!0;break}return c};this.isThereChildItems=!1;var F=function(b,c,d,f){var g=!0;if(!b[a.options.dataFields.items])return g=I(b,c,d,f);if(g=I(b,c,d,f)){d=0;var e=!0;if(f||U(b)){var h=b[a.options.dataFields.items];if(h){a.applySorting(h);for(var k=0;k<h.length;k++)(e=F(h[k],c+t,b[a.options.dataFields.id],f))&&d++}}f||a.isThereChildItems||!(0<d||!U(b)&&b[a.options.dataFields.items]&&0<b[a.options.dataFields.items].length&&a.isThereVisibleChildren(b))||(a.isThereChildItems=!0)}return g};a.fullList=[];this.getFullList=function(b){a.fullList.length=0;b=a.dataObj.getList(b);for(var c=0;c<b.length;c++)F(b[c],0,null,!0);return a.fullList};this.getCurrentList=function(){return a.currentList};this.updateCurrentList=function(){a.currentList.length=0;a.indentList.length=0;a.isThereChildItems=!1;J=0;var b=a.dataObj.getList();if(b){a.applySorting(b);for(var c=0;c<b.length;c++)F(b[c],0,null,!1)}};this.dataEvents={clear:function(a){return angular.isDefined(d.events)&&d.events.clear?d.events.clear({parent:a.e.parent}):d.clear(a)},objAdded:function(a){return angular.isDefined(d.events)&&d.events.itemAdded?d.events.itemAdded({item:a.e.item}):d.itemAdded(a)},objAdding:function(a){return angular.isDefined(d.events)&&d.events.itemAdding?d.events.itemAdding({item:a.e.item}):d.itemAdding(a)},objRemoved:function(a){return angular.isDefined(d.events)&&d.events.itemRemoved?d.events.itemRemoved({item:a.e.item}):d.itemRemoved(a)},objRemoving:function(a){return angular.isDefined(d.events)&&d.events.itemRemoving?d.events.itemRemoving({item:a.e.item}):d.itemRemoving(a)}};this.getDataFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",pid:a.pid?a.pid:"pid",objects:a.items?a.items:"items",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",text:a.text?a.text:"text"}};a.dataObj=new D({objects:d.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)});d.$on(d.name+"-load-data",function(b,c,d,f,g){a.loadData(c,d,f,g)});d.$on(d.name+"-export-json",function(b,c,d,f){h.setTempData(a.exportToJSON(c,d,f))});this.exportToJSON=function(b,c,d){d=d?d:null;var f=!1!==c?a.getFullList():a.dataObj.getList();b=b?b:[a.options.dataFields.allowDrag,a.options.dataFields.allowDrop,a.options.dataFields.allowFocus,a.options.dataFields.autoCheck,a.options.dataFields.checkBoxSettings,a.options.dataFields.checked,a.options.dataFields.checkState,a.options.dataFields.content,a.options.dataFields.enabled,a.options.dataFields.expanded,a.options.dataFields.hasChildren,a.options.dataFields.icon,a.options.dataFields.id,a.options.dataFields.pid,a.options.dataFields.statusIcon,a.options.dataFields.style,a.options.dataFields.text,a.options.dataFields.value];!1===c&&b.push(a.options.dataFields.items);return JSON.stringify(f,b,d)};this.loadData=function(b,c,m,f){a.allowEvents=!1;a.updateDataFields(m);var g=[],e=a.options.dataFields;a.dataObj.clear(c);if(b)if(0!=f){var h=[];b.forEach(function(a,b){var c=a[e.pid];h[c]?(h[c][e.items]||(h[c][e.items]=[]),h[a[e.id]]=a,h[c][e.items].push(a)):(h[a[e.id]]=a,g.push(a))});h.length=0}else g=b;if(c)for(c[a.options.dataFields.items]=g,b=0;b<c[a.options.dataFields.items].length;b++)c[a.options.dataFields.items][b][a.options.dataFields.pid]=c[a.options.dataFields.id];else angular.isDefined(d.items)&&(d.items=g);a.dataObj=new D({objects:d.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)});a.updateLayout();a.allowEvents=!0};this.updateDataFields=function(b){b&&(a.options.dataFields={allowDrag:b.allowDrag?b.allowDrag:"allowDrag",allowDrop:b.allowDrop?b.allowDrop:"allowDrop",allowFocus:b.allowFocus?b.allowFocus:"allowFocus",autoCheck:b.autoCheck?b.autoCheck:"autoCheck",checkBoxSettings:b.checkBoxSettings?b.checkBoxSettings:"checkBoxSettings",checked:b.checked?b.checked:"checked",checkState:b.checkState?b.checkState:"checkState",content:b.content?b.content:"content",dataSource:b.dataSource,enabled:b.enabled?b.enabled:"enabled",expanded:b.expanded?b.expanded:"expanded",hasChildren:b.hasChildren?b.hasChildren:"hasChildren",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",items:b.items?b.items:"items",pid:b.pid?b.pid:"pid",statusIcon:b.statusIcon?b.statusIcon:"statusIcon",style:b.style?b.style:"style",text:b.text?b.text:"text",value:b.value?b.value:"value"},a.dataObj&&a.dataObj.updateDataFields(a.options.dataFields))};this.updateData=function(){a.options.dataFields.dataSource&&(a.loadData(a.options.dataFields.dataSource),a.dataObj=new D({objects:d.items,events:a.dataEvents,fields:a.getDataFields(a.options.dataFields)}))};var N=!1;this.dragDropStatus=function(a){if(a)N=a;else return N};this.getDnDSource=function(a){return{text:a.dataTransfer?a.dataTransfer.getData("text"):a.originalEvent.dataTransfer?a.originalEvent.dataTransfer.getData("text"):""}};var q=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};angular.element(k).bind("dragenter",function(b){a.dropMark()});angular.element(k).bind("dragend",function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer()});a.getMousePos=function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}};this.getTreeName=function(){return angular.isDefined(d.name)?d.name:""};l.bind("dragenter",function(b){b.preventDefault();var c=n.getData();c.source||(c.source=a.getDnDSource(b));b={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(b)});l.bind("dragover",function(b){b.preventDefault();var c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c){b.dataTransfer?b.dataTransfer.dropEffect=a.options.allowDrop?"move":"none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect=a.options.allowDrop?"move":"none");c=n.getData();c.source||(c.source=a.getDnDSource(b));n.setData({source:c.source,sourceCtrl:c.sourceCtrl,target:null,dropPos:-1});c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};a.callDragOver(c);c=a.getMousePos(b);b=c.y+16;var c=c.x+20,m=a.getDropMarkWindow();m.empty();m.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(d.name?d.name:"TreeView")+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:c});a.dropMark(!0)}});l.bind("drop",function(b){b.preventDefault();a.dropMark();var c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c&&(c=n.getData(),c.source||(c.source=a.getDnDSource(b)),c.source)){var m={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};!1!==a.callDragDrop(m)&&(a.drop(c),d.$$phase||d.$apply())}n.clearData();b.stopPropagation()});l.bind("dragleave",function(b){b.preventDefault();a.dropMark();var c=n.getData();c.source||(c.source=a.getDnDSource(b));b={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(b);a.cancelScrollTimer()});l.bind("dragend",function(b){b.preventDefault();a.dropMark();n.getData().source||n.clearData()});l.bind("mouseleave",function(b){b.preventDefault();a.dropMark();a.hoverItem=null});this.containsMousePos=function(a,c){return n.hitTest(a,c,{left:0,top:0,right:l[0].clientWidth,bottom:l[0].clientHeight})};this.isPopupActive=function(){return!1};var ga=function(b,c){var d=a.options.dataFields;b[d.items]||(b[d.items]=[]);b[d.items].length=0;if(b[c.rows]&&0<b[c.rows].length)for(var f=0;f<b[c.rows].length;f++)b[d.items].push(ga(b[c.rows][f],c));return b},V=function(b,c){var d=!1;c.sourceCtrl&&(d=c.sourceCollection.removeAt(b,-1,null,c.sourceCtrl.objIsRemoved));d&&("row"==b.type&&(b=ga(b,c.sourceCtrl.options.rowFields)),0===c.dropPos?a.dataObj.insertAt(b,-1,c.target,a.itemIsAdded):1===c.dropPos||2===c.dropPos?1===c.dropPos?a.dataObj.insertByRef(b,c.target,!1,a.itemIsAdded):a.dataObj.insertByRef(b,c.target,!0,a.itemIsAdded):a.dataObj.insertAt(b,-1,null,a.itemIsAdded))};this.setDropSelection=function(b,c){var d=b;!d&&0<=c&&c<a.currentList.length&&(d=a.currentList[c]);a.clearPrevSelection(d);a.itemSelection(d)};this.drop=function(b){if(b&&b.sourceCtrl){b.sourceCtrl.suppressProcess=!0;b.sourceCtrl.suspendLayout();a.suspendLayout();var c=b.source;if(Array.isArray(b.source)){for(var m=[],f=0;f<b.source.length;f++){for(var g=!1,h=b.sourceCollection.getParent(b.source[f]);h;){if(b.sourceCtrl.isObjInSelList(h)){g=!0;break}h=b.sourceCollection.getParent(h)}g||m.push(b.source[f])}if(0<m.length)if(c=m[m.length-1],f=b.sourceCtrl.getObjCurrentIndex(m[0]),g=b.sourceCtrl.getObjCurrentIndex(c),f<=g)for(f=0;f<m.length;f++)V(m[f],b);else for(f=m.length-1;0<=f;f--)V(m[f],b)}else V(b.source,b);b.sourceCtrl!==a?(a.resumeLayout(),b.sourceCtrl.resumeLayout()):a.resumeLayout();b.sourceCtrl.multiSelection(!1);var k=e(function(){if(c){b.sourceCtrl.clearPrevSelection(c);a.itemSelection(c);var m=a.getElemFromItem(c);m&&(m=a.getElement(m))&&m[0].focus();d.$apply();e.cancel(k)}},1);b.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(b){return a.options.allowDrag?b&&(b[a.options.dataFields.allowDrag]||void 0===b[a.options.dataFields.allowDrag])?!0:!1:!1};this.isChildOf=function(b,c){var d=!1;if(b&&c){var f=c[a.options.dataFields.items];if(f&&0<f.length)for(var e=0;e<f.length;e++){if(g.isEqual(b[a.options.dataFields.id],f[e][a.options.dataFields.id])){d=!0;break}else d=a.isChildOf(b,f[e]);if(d)break}}return d};this.isParentOf=function(b,c){var d=a.dataObj.getParent(c);return b&&c&&d&&g.isEqual(b[a.options.dataFields.id],d[a.options.dataFields.id])?!0:!1};this.isDropAllowed=function(b,c,d){var f=a.options.allowDrop;if(f&&b&&c&&(f=c[a.options.dataFields.allowDrop]||void 0===c[a.options.dataFields.allowDrop]?!0:!1))if(Array.isArray(b))for(var e=0;e<b.length;e++){if(g.isEqual(b[e][a.options.dataFields.id],c[a.options.dataFields.id])||0===d&&a.isParentOf(c,b[e])||a.isChildOf(c,b[e])){f=!1;break}if(!f)break}else if(g.isEqual(b[a.options.dataFields.id],c[a.options.dataFields.id])||0===d&&a.isParentOf(c,b)||a.isChildOf(c,b))f=!1;return f};this.getDropMarkWindow=function(){for(var a=q,c=angular.element(document.body).children(),d=0;d<c.length;d++){var f=angular.element(c[d]);if(f[0].attributes&&f[0].attributes["data-element"]&&"dropmark"===f[0].attributes["data-element"].value){a=f;break}}return a};this.dropMark=function(b,c){c||(c=a.getDropMarkWindow());if(c){var d="none";this.options.allowDrop&&(d=b?"block":"none");angular.element(c).css("display",d)}};this.updateDropMarkElem=function(a,c){a&&c&&(a.css("top",c.top+"px"),a.css("left",c.left+"px"),a.css("width",c.width+"px"))};var ha=!1,O=angular.element('<input type="text" style="position:absolute" />');this.labelEditStatus=function(a){if(void 0!=a)ha=a;else return ha};this.getEditBox=function(){return O};this.updateEditBox=function(a){O&&a&&(O.css("top",a.top+"px"),O.css("left",a.left+"px"),O.css("width",a.width+"px"),O.css("height",a.height+"px"))};this.updateEditorSettings=function(b){a.options.editorSettings=b?{activate:g.isFieldAvailable(b.activate,"click")}:{activate:"click"}};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(d.events)&&d.events.afterCollapse&&d.events.afterCollapse({item:a});d.afterCollapse({e:{item:a}})};this.callAfterExpand=function(a){angular.isDefined(d.events)&&d.events.afterExpand&&d.events.afterExpand({item:a});d.afterExpand({e:{item:a}})};this.callAfterEdit=function(a){angular.isDefined(d.events)&&d.events.afterLabelEdit&&d.events.afterLabelEdit({item:a});d.afterLabelEdit({e:{item:a}})};this.callAfterSelect=function(a){angular.isDefined(d.events)&&d.events.afterSelect?d.events.afterSelect({item:a}):d.afterSelect({e:{item:a}});angular.isDefined(d.events)&&d.events.selectionChanged?d.events.selectionChanged({item:a}):d.selectionChanged({e:{item:a}})};this.callBeforeCollapse=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeCollapse?d.events.beforeCollapse({item:a}):d.beforeCollapse({e:{item:a}})};this.callBeforeExpand=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeExpand?d.events.beforeExpand({item:a}):d.beforeExpand({e:{item:a}})};this.callBeforeEdit=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.beforeLabelEdit?d.events.beforeLabelEdit({item:a}):d.beforeLabelEdit({e:{item:a}})};this.callDragEnter=function(a){angular.isDefined(d.events)&&d.events.dragEnter?d.events.dragEnter({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):d.dragEnter({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callDragOver=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.dragOver?d.events.dragOver({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):d.dragOver({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){var c=!0;return c=angular.isDefined(d.events)&&d.events.dragDrop?d.events.dragDrop({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):d.dragDrop({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragLeave=function(a){angular.isDefined(d.events)&&d.events.dragLeave?d.events.dragLeave({sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}):d.dragLeave({e:{sourceTree:a.sourceTree,dragItem:a.dragItem,targetTree:a.targetTree,targetItem:a.targetItem,mousePos:a.mousePos}})};this.callItemClick=function(a,c){angular.isDefined(d.events)&&d.events.itemClick&&d.events.itemClick({item:a,mousePos:c});d.itemClick({e:{item:a,mousePos:c}})};this.callItemDblClick=function(a,c){angular.isDefined(d.events)&&d.events.itemDblClick&&d.events.itemDblClick({item:a,mousePos:c});d.itemDblclick({e:{item:a,mousePos:c}});return!0};this.callItemHover=function(a){retValue=angular.isDefined(d.events)&&d.events.itemHover?d.events.itemHover({item:a}):d.itemHover({e:{item:a}})};this.callItemRightClick=function(a,c){angular.isDefined(d.events)&&d.events.itemRightClick&&d.events.itemRightClick({item:a,mousePos:c});d.itemRightclick({e:{item:a,mousePos:c}})};this.callKeyDown=function(a,c){angular.isDefined(d.events)&&d.events.keyDown?d.events.keyDown({event:a,item:c}):d.keyDown({e:{event:a,item:c}})};this.callKeyPress=function(a,c){angular.isDefined(d.events)&&d.events.keyPress?d.events.keyPress({event:a,item:c}):d.keyPress({e:{event:a,item:c}})};this.callKeyUp=function(a,c){angular.isDefined(d.events)&&d.events.keyUp?d.events.keyUp({event:a,item:c}):d.keyUp({e:{event:a,item:c}})};l.bind("click",function(b){1===b.which&&a.callItemClick(null,a.getMousePos(b))});l.bind("dblclick",function(b){b.preventDefault();1===b.which&&a.callItemDblClick(null,a.getMousePos(b));b.stopPropagation()});l.bind("mousedown",function(b){3===b.which&&a.callItemRightClick(null,a.getMousePos(b));b.stopPropagation()});this.toggle=function(b,c){if(b){if(b[a.options.dataFields.hasChildren]||b[a.options.dataFields.items]&&0!==b[a.options.dataFields.items].length)if(!c||!1===b[a.options.dataFields.expanded])if(!1!==c||!1!==b[a.options.dataFields.expanded]){var d=void 0!==c?c:!1!==b[a.options.dataFields.expanded]?!0:!1,f=!0,f=void 0!==c?c?a.callBeforeExpand(b):a.callBeforeCollapse(b):d?a.callBeforeCollapse(b):a.callBeforeExpand(b);!1!==f&&(f=b[a.options.dataFields.expanded],b[a.options.dataFields.expanded]=void 0!==c?c:!d,b[a.options.dataFields.expanded]?a.callAfterExpand(b):a.callAfterCollapse(b),f!==b[a.options.dataFields.expanded]&&a.updateLayout())}}else{a.suspendLayout();d=a.getFullList();for(f=0;f<d.length;f++)a.toggle(d[f],c);a.resumeLayout()}};d.$on(d.name+"-begin-load",function(b,c){a.options.loadItem=c});d.$on(d.name+"-collapse",function(b,c){a.toggle(c,!1)});d.$on(d.name+"-end-load",function(b){a.options.loadItem=null});d.$on(d.name+"-expand",function(b,c){a.toggle(c,!0)});d.$on(d.name+"-toggle",function(b,c){a.toggle(c)});this.filterParams=null;d.$on(d.name+"-filter",function(b,c){a.filter(c)});this.filter=function(b){a.filterParams=b;a.updateLayout()};this.callGotFocus=function(a,c,m,f){angular.isDefined(d.events)&&d.events.gotFocus?d.events.gotFocus({event:a,item:c,edit:void 0!=m?!0:!1,editValue:f}):d.gotFocus({e:{event:a,item:c,edit:void 0!=m?!0:!1,editValue:f}})};this.callLostFocus=function(a,c,m,f){angular.isDefined(d.events)&&d.events.lostFocus?d.events.lostFocus({event:a,item:c,edit:void 0!=m?!0:!1,editValue:f}):d.lostFocus({e:{event:a,item:c,edit:void 0!=m?!0:!1,editValue:f}})};this.getTabIndex=function(){return l[0].attributes&&l[0].attributes.tabindex?l[0].attributes.tabindex.value:""};this.updateFocus=function(b){if(1==a.options.allowFocus)var c=e(function(){if(b){var d=a.getElemFromItem(b);d&&(d=a.getElement(d))&&d[0].focus()}else l[0].focus();e.cancel(c)},5)};d.$on(d.name+"-focus",function(b,c){a.updateFocus(c)});var W=!1,U=function(b){return b?b[a.options.dataFields.expanded]||void 0===b[a.options.dataFields.expanded]?!0:!1:!0};this.getElement=function(a,c){var d=null;c||(c="content");if(a)for(var f=a.children(),g=0;g<f.length;g++){var e=angular.element(f.eq(g));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value===c){d=e;break}}return d};this.getElemFromItem=function(b){var c=null;if(b){b=a.getItemCurrentIndex(b);var d=l.find("li");if(d&&0<d.length)for(var f=0;f<d.length;f++){var g=angular.element(d[f]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===b.toString()){c=g;break}}}return c};this.getIndent=function(b){var c=0;if(b)for(parent=a.dataObj.getParent(b);parent;)c+=a.options.indent,parent=a.dataObj.getParent(parent);return c};this.getItemCurrentIndex=function(b){return b&&a.currentList?a.currentList.indexOf(b):-1};this.getObjCurrentIndex=function(b){return a.getItemCurrentIndex(b)};this.getObjState=function(b){if(b)switch(b.type){case "item":if(0==b[a.options.dataFields.enabled])return"disabled";if(1==b.selected&&a.isObjInSelList(b))return"selected";if(b==a.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(b){return b?(b=angular.element(b))?a.getItemFromElem(b[0].parentElement):null:null};this.getItemFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,a.isIndexInRange(b)))return a.currentList[b]};this.isIndexInRange=function(b){return 0<=b&&b<a.currentList.length};this.isItemEnabled=function(b){return g.isEnabled(b[a.options.dataFields.enabled])};this.mouseButtonStatus=function(a){W=a};d.$on(d.name+"-ensure-visible",function(b,c,d){a.ensureVisible(c,d)});d.$on(d.name+"-find-item-by-id",function(b,c){h.setTempData(a.findItemById(c))});d.$on(d.name+"-find-item-by-text",function(b,c){h.setTempData(a.findItemByText(c))});d.$on(d.name+"-get-full-path",function(b,c){h.setTempData(a.getFullPath(c))});d.$on(d.name+"-get-item-level",function(b,c){h.setTempData(a.getLevel(c))});d.$on(d.name+"-get-item-parent",function(b,c){h.setTempData(a.getParent(c))});d.$on(d.name+"-get-flat-list",function(b,c){c?h.setTempData(a.getFullList()):h.setTempData(a.currentList)});d.$on(d.name+"-get-list",function(b,c,d){1==d?h.setTempData(a.getFullList(c)):h.setTempData(a.getList(c))});this.ensureVisible=function(b,c){if(b){a.suspendLayout();for(var d=[],f=a.getParent(b);f;)d.push(f),f=a.getParent(f);for(f=d.length-1;0<=f;f--)a.toggle(d[f],!0);a.resumeLayout();c||(c="center");a.scrollTo(b,c)}};this.findItemById=function(b){return a.dataObj.findObjectById(b)};this.findItemByText=function(b){return a.dataObj.findObjectByText(b)};this.getFullPath=function(b){var c="";if(b)for(c=b[a.options.dataFields.text],b=a.getParent(b);b;)c=[b[a.options.dataFields.text],a.options.pathSeparator,c].join(""),b=a.getParent(b);return c};this.getLevel=function(a){var c=0;for(a=this.getParent(a);a;)c++,a=this.getParent(a);return c};this.getParent=function(b){return a.dataObj.getParent(b)};this.getList=function(b){return a.dataObj.getList(b)};this.getFirstItem=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}return b};this.getPrevItem=function(b){var c=null;if(0<=b&&b<a.currentList.length)for(--b;0<=b;b--)if(a.isItemEnabled(a.currentList[b])){c=a.currentList[b];break}return c};this.getNextItem=function(b){var c=null;for(b+=1;b<a.currentList.length;b++)if(a.isItemEnabled(a.currentList[b])){c=a.currentList[b];break}return c};this.getLastItem=function(){for(var b=null,c=a.currentList.length-1;0<=c;c--)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}return b};this.updateSelectionStatus=function(b){switch(b){case "shift":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);a.shiftKeyStatus(!1);break;case "multi-extended":a.multiSelection(!0);a.shiftKeyStatus(!0);break;default:a.multiSelection(!1),a.shiftKeyStatus(!1)}break;case "ctrl":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}}};l.bind("keydown",function(b){switch(b.keyCode){case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}});a.allowUpdate=!0;this.suspendLayout=function(){a.allowUpdate=!1};this.resumeLayout=function(){a.allowUpdate=!0;a.updateLayout()};d.$on(d.name+"-refresh",function(b,c,d){a.refresh(c,d)});d.$on(d.name+"-resume-layout",function(b){a.resumeLayout()});d.$on(d.name+"-suspend-layout",function(b){a.suspendLayout()});d.$on(d.name+"-update-layout",function(b){a.updateLayout()});d.$on(d.name+"-update-view",function(b){a.updateView()});d.$on(d.name+"-get-scroll-pos",function(b){h.setTempData(a.getScrollPos())});d.$on(d.name+"-set-scroll-pos",function(b,c){a.setScrollPos(c)});d.$on(d.name+"-scroll-to",function(b,c,d){a.scrollTo(c,d)});var K=!1,L=!1;this.shiftKeyStatus=function(a){if(void 0!=a)K=a;else return K};this.multiSelection=function(a){if(void 0!=a)L=a;else return L};this.isItemSelected=function(a){return g.isSelected(a)};this.clearPrevSelection=function(b){for(var c=0;c<a.options.selectedItems.length;c++)b&&!g.isEqual(a.options.selectedItems[c][a.options.dataFields.id],b[a.options.dataFields.id])?a.options.selectedItems[c].selected=!1:b||(a.options.selectedItems[c].selected=!1);a.options.selectedItems.length=0;b&&a.isItemEnabled(b)&&a.options.selectedItems.push(b);a.refresh()};this.itemSelection=function(b,c){if(b){if("none"!==a.options.selectionMode)if(a.isItemEnabled(b)){var e=a.itemSelection(),f=!0;e&&(f=!g.isEqual(e[a.options.dataFields.id],b[a.options.dataFields.id]));var h=!0,h=angular.isDefined(d.events)&&d.events.beforeSelect?d.events.beforeSelect({item:b}):d.beforeSelect({e:{item:b}});if(!1!==h)if(f){f=!0;"multi-extended"===a.options.selectionMode&&(f=!a.isObjInSelList(b));f&&(W&&K?a.clearPrevSelection():L||"multi-simple"===a.options.selectionMode||a.clearPrevSelection());a.options.selectedItem=b;if(W&&K){if(f=a.getItemCurrentIndex(e),e=a.getItemCurrentIndex(b),f>e&&(h=f,f=e,e=h),a.isIndexInRange(f)&&a.isIndexInRange(e))for(;f<=e;f++)a.currentList[f].selected=!0,a.options.selectedItems.push(a.currentList[f])}else W&&(L||"multi-simple"===a.options.selectionMode)?(e=null===b.selected||"undefined"===b.selected?!1:b.selected,b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedItems.push(b):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=b})):(b.selected=!0,a.isObjInSelList(b)||a.options.selectedItems.push(b));angular.isDefined(d.selectedItem)&&(d.selectedItem=b);a.callAfterSelect(b);a.refresh()}else if(L||"multi-simple"===a.options.selectionMode)e=null===b.selected||"undefined"===b.selected?!1:b.selected,c&&"undefined"!==c&&(e=c),b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedItems.push(b):a.options.selectedItems=a.options.selectedItems.filter(function(a){return a!=b}),a.callAfterSelect(b),a.refresh()}else a.clearPrevSelection()}else return a.options.selectedItem};this.updateSelection=function(b){"multi-simple"!==a.options.selectionMode&&0<a.options.selectedItems.length&&!K&&!L&&a.clearPrevSelection(b)};this.selectFirstItem=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(a.isItemEnabled(a.currentList[c])){b=a.currentList[c];break}this.itemSelection(b);return a.options.selectedItem};this.isObjInSelList=function(b){var c=!1,d=a.options.selectedItems;if(b&&d)for(var f=0;f<d.length;f++)if(g.isEqual(d[f][a.options.dataFields.id],b[a.options.dataFields.id])){c=!0;break}return c};this.getItemAt=function(b,c){var d=null,f=null,e=null,h=l.find("li");if(h&&0<h.length)for(var k=0;k<h.length;k++)if(d=angular.element(h[k]),f=g.getPageRect(d),g.checkHit(b,c,f)){e=a.getItemFromElem(d);break}return e};this.resetSelection=function(){switch(a.options.selectionMode){case "none":a.clearPrevSelection();break;default:a.clearPrevSelection(a.itemSelection())}};d.$on(d.name+"-get-selected-item",function(b){h.setTempData(a.itemSelection())});d.$on(d.name+"-set-selected-item",function(b,c){a.itemSelection(c)});d.$on(d.name+"-get-selected-items",function(b){h.setTempData(a.options.selectedItems)});d.$watch("options.allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});d.$watch("allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});d.$watch("options.allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});d.$watch("allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});d.$watch("options.allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});d.$watch("allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});d.$watch("options.autoCheck",function(b,c){b!==c&&(a.options.autoCheck=b,a.updateView())});d.$watch("autoCheck",function(b,c){b!==c&&(a.options.autoCheck=b,a.updateView())});d.$watch("autoExpand",function(b,c){b!==c&&(a.options.autoExpand=b)});d.$watch("checkBoxSettings",function(b,c){b!==c&&a.updateCheckBoxSettings(b)});d.$watch("controlStyle",function(b,c){b!==c&&a.updateControlStyle(b)});d.$watch("editorSettings",function(b,c){b!==c&&a.updateEditorSettings(b)});d.$watch("options.dataFields",function(b,c){b!==c&&(a.updateDataFields(b),a.UpdateData())});d.$watch("fields",function(b,c){b!==c&&(a.options.dataFields=b,a.UpdateData())});d.$watch("options.hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});d.$watch("hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});d.$watch("options.itemIcon",function(b,c){b!==c&&(a.options.itemIcon=b,a.updateLayout())});d.$watch("itemIcon",function(b,c){b!==c&&(a.options.itemIcon=b,a.updateLayout())});d.$watch("options.labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});d.$watch("labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});d.$watch("options.pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});d.$watch("pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});d.$watch("options.rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});d.$watch("rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});d.$watch("options.selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});d.$watch("selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});d.$watch("options.showCheckBoxes",function(b,c){b!==c&&(a.options.showCheckBoxes=b,a.updateLayout())});d.$watch("showCheckBoxes",function(b,c){b!==c&&(a.options.showCheckBoxes=b,a.updateLayout())});d.$watch("options.showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});d.$watch("showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});d.$watch("options.showStatusIcons",function(b,c){b!==c&&(a.options.showStatusIcons=b,a.updateLayout())});d.$watch("showStatusIcons",function(b,c){b!==c&&(a.options.showStatusIcons=b,a.updateLayout())});d.$watch("options.selectedItem",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedItem=b,a.callAfterSelect(b))});d.$watch("selectedItem",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedItem=b,a.callAfterSelect(b))});this.sortComparer=null;d.$watch("sorting",function(b,c){b!==c&&(a.options.sorting=b)});d.$on(d.name+"-sort",function(b,c,d){a.sort(c,d)});this.sort=function(b,c){a.sortComparer=c;if("ascending"==b||"descending"==b||"none"==b)a.options.sorting=b;a.updateLayout()};this.isSortingAllowed=function(){return"ascending"==a.options.sorting||"descending"==a.options.sorting};this.applySorting=function(b){b&&(a.sortComparer?b.sort(a.sortComparer):a.isSortingAllowed()&&b.sort(function(b,d){var f=null,e=null;(f=b[a.options.dataFields.value])||(f=b[a.options.dataFields.text]);g.isObject(f)&&(f=f.value?f.value:f.text);(e=d[a.options.dataFields.value])||(e=d[a.options.dataFields.text]);g.isObject(e)&&(e=e.value?e.value:e.text);f=void 0!=f?f:null;e=void 0!=e?e:null;switch(a.options.sorting){case "ascending":if(f<e)return-1;if(f>e)return 1;break;case "descending":if(f>e)return-1;if(f<e)return 1;break;default:return 0}}))};var B=function(b){if(b){var c=g.isFieldAvailable(b.general,"iui-checkbox");b=(b=b.box)?{general:g.isFieldAvailable(b.general,"iui-checkbox-box"),disabled:g.isFieldAvailable(b.disabled,"iui-checkbox-disabled"),checked:g.isFieldAvailable(b.checked,"iui-checkbox-checked"),indeterminate:g.isFieldAvailable(b.indeterminate,"iui-checkbox-indeterminate"),unchecked:g.isFieldAvailable(b.unchecked,"iui-checkbox-unchecked")}:a.options.controlStyle.item.checkBox.box;return{general:c,box:b}}return a.options.controlStyle.item.checkBox};this.getExpandBoxStyle=function(b){return b?{general:g.isFieldAvailable(b.general,"iui-treeview-expand-box"),animated:g.isFieldAvailable(b.animated,"iui-treeview-expand-box-load"),expanded:g.isFieldAvailable(b.expanded,"iui-treeview-expand-box-open"),collapsed:g.isFieldAvailable(b.collapsed,"iui-treeview-expand-box-close")}:a.options.controlStyle.item.expandBox};var C=function(b){if(b){var c;c=b.general;c=g.isString(c)?c:c?{disabled:g.isFieldAvailable(c.disabled,"iui-treeview-item-disabled"),focused:g.isFieldAvailable(c.focused,"iui-treeview-item-focused"),normal:g.isFieldAvailable(c.normal,"iui-treeview-item"),hovered:g.isFieldAvailable(c.hovered,"iui-treeview-item-hovered"),selected:g.isFieldAvailable(c.selected,"iui-treeview-item-selected")}:a.options.controlStyle.item.general;var d=B(b.checkBox),e=a.getExpandBoxStyle(b.expandBox);b=b.content;b=g.isString(b)?b:b?{disabled:g.isFieldAvailable(b.disabled,"iui-treeview-item-content-disabled"),focused:g.isFieldAvailable(b.focused,"iui-treeview-item-content-focused"),normal:g.isFieldAvailable(b.normal,"iui-treeview-item-content"),hovered:g.isFieldAvailable(b.hovered,"iui-treeview-item-content-hovered"),selected:g.isFieldAvailable(b.selected,"iui-treeview-item-content-selected")}:a.options.controlStyle.item.content;return{general:c,checkBox:d,expandBox:e,content:b}}return a.options.controlStyle.item};this.updateControlStyle=function(b){a.options.controlStyle=b?{general:g.isFieldAvailable(b.general,"iui-treeview"),item:C(b.item)}:{general:g.isFieldAvailable(a.defaultStyle.general,"iui-treeview"),item:C(a.defaultStyle.item)}};this.getCurrentItemStyle=function(b,c){var d=a.options.controlStyle.item;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemStyle(a.getParent(b),c);default:null!=b.style&&(d=b.style)}if(c){if(g.isString(d.general))return d.general;switch(c){case "disabled":return d.general&&d.general.disabled?d.general.disabled:a.options.controlStyle.item.general.disabled;case "focused":return d.general&&d.general.focused?d.general.focused:a.options.controlStyle.item.general.focused;case "hovered":return d.general&&d.general.hovered?d.general.hovered:a.options.controlStyle.item.general.hovered;case "selected":return d.general&&d.general.selected?d.general.selected:a.options.controlStyle.item.general.selected;default:return d.general&&d.general.normal?d.general.normal:a.options.controlStyle.item.general.normal}}else return d?d:a.options.controlStyle.item};this.getCurrentItemContentStyle=function(b,c){var d=a.options.controlStyle.item.content;if(b)switch(b.style){case "initial":break;case "parent":return a.getCurrentItemContentStyle(a.getParent(b),c);default:null!=b.style&&b.style.content&&(d=b.style.content)}if(c){if(g.isString(d))return d;switch(c){case "disabled":return d&&d.disabled?d.disabled:a.options.controlStyle.item.content.disabled;case "focused":return d&&d.focused?d.focused:a.options.controlStyle.item.content.focused;case "hovered":return d&&d.hovered?d.hovered:a.options.controlStyle.item.content.hovered;case "selected":return d&&d.selected?d.selected:a.options.controlStyle.item.content.selected;default:return d&&d.normal?d.normal:a.options.controlStyle.item.content.normal}}else return d?d:a.options.controlStyle.item.content}}]).directive("iuiTreeview",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop","$window",function(d,l,e,k,g,D){return{restrict:"EA",controller:"IntegralUITreeViewController",transclude:!0,replace:!0,template:'<div class="iui-treeview" data-element="treeview"><ul class="iui-treeview-block"></ul></div>',scope:{allowAnimation:"=",allowDrag:"=",allowDrop:"=",allowFocus:"=",animationSpeed:"=",autoCheck:"=",autoExpand:"=",checkboxSettings:"=",controlStyle:"=",editorSettings:"=",fields:"=",hoverSelection:"=",itemIcon:"=",items:"=",labelEdit:"=",name:"@",options:"=?",pathSeparator:"@",rtl:"=",selectedIndex:"=",selectedItem:"=",selectionMode:"@",showCheckBoxes:"=",showIcons:"=",showStatusIcons:"=",sorting:"@",afterCollapse:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",clear:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",gotFocus:"&",keyDown:"&",keyPress:"&",keyUp:"&",lostFocus:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(h,n,ea,a,G){var p=this,y=n.children().eq(0),v=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),t=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),J=angular.element('<div class="iui-scrollbar-corner"></div>'),I=null,F=null,N=null,q=a.getEditBox(),ga=function(){var b="iui-treeview-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};h.$on("destroy",function(a){p.s2t();n.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(D).unbind("dragenter dragover dragend mousemove mouseup");q&&q.unbind("blur focus keydown mousedown");V();C&&C.$destroy()});n.append(a.getDropMarkWindow());a.dropMark();a.addDropMark=function(){var b;b=n[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};var V=function(){var b=y.find("li");if(0<b.length)for(var c=0;c<b.length;c++){currentElem=angular.element(b[c]);currentElem.unbind("dragover drop dragenter dragleave dragend");var d=a.getElement(currentElem,"expandbox");d&&d.unbind("click");(d=a.getElement(currentElem))&&d.unbind("blur click dragstart dragover drop dragenter dragleave dblclick focus keydown keypress keyup mouseenter mouseleave mousedown mouseup")}},ha=function(b){b&&(b.bind("dragover",function(b){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=n[0].getBoundingClientRect();c.x-=angular.element(D)[0].pageXOffset;c.y-=angular.element(D)[0].pageYOffset;c.y<d.top+25?ia(!1):c.y>d.bottom-25?ia(!0):X()}else X();b.stopPropagation()}),b.bind("dragend",function(b){b.preventDefault();a.dragDropStatus(!1);a.dropMark();g.getData().source||g.clearData()}))},O=function(b){b&&b.bind("click",function(b){var c=angular.element(this);(c=a.getItemFromChildElem(c))&&a.toggle(c);b.stopPropagation()})};a.dragIcon=document.createElement("img");a.dragIcon.width=1;var W=function(b,c){if(b){a.isDragAllowed(c)&&b.attr("draggable",!0);if(1==a.options.allowFocus){var d=a.getTabIndex().toString()+(a.getItemCurrentIndex(a.getItemFromChildElem(b))+1).toString();b.attr("tabindex",d)}b.bind("dragstart",function(b){if(a.labelEditStatus())b.preventDefault();else{g.clearData();var c=a.getItemFromChildElem(this);if(c)if(F&&(l.cancel(F),F=null),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.dataFields.id]?c[a.options.dataFields.id].toString():""));b={source:c,sourceCtrl:a,sourceCollection:a.dataObj};switch(a.options.selectionMode){case "multi-simple":b.source=a.options.selectedItems;break;case "multi-extended":b.source=a.options.selectedItems}g.setData(b)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none")}});b.bind("dragover",function(b){var c=angular.element(this);b.preventDefault();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getItemFromChildElem(c);if(e){var d=c[0].getBoundingClientRect(),f=angular.element(D)[0].pageXOffset,r=angular.element(D)[0].pageYOffset,w=a.getMousePos(b);w.x-=d.left+f;w.y-=d.top+r;c=g.getDropPos(w,{x:0,y:0,width:c[0].offsetWidth,height:c[0].offsetHeight});f=g.getData();d=a.isDropAllowed(f.source,e,c);r={sourceTree:f.sourceCtrl?f.sourceCtrl.getTreeName():"",dragItem:f.source,targetTree:a.getTreeName(),targetItem:e,isDropAllowed:d,dropPos:c,mousePos:a.getMousePos(b)};r=a.callDragOver(r);if(d&&0!=r){r=a.getMousePos(b);b=r.y+16;r=r.x+20;w=a.getDropMarkWindow();w.empty();var h="iui-drop-marker-move-in";switch(c){case 1:h="iui-drop-marker-move-up";break;case 2:h="iui-drop-marker-move-down"}w.append("<span class='"+h+"'></span><span class='iui-drop-marker-title'>"+e[a.options.dataFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:r});a.dropMark(d);g.setData({source:f.source,sourceList:f.sourceList,target:e,dropPos:c})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}});b.bind("drop",function(b){var c=angular.element(this);b.preventDefault();I&&(l.cancel(I),I=null);a.dropMark();var d=!0;b.dataTransfer?d="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(d="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var e=a.getItemFromChildElem(c);if(e){var c=g.getData(),f=c.source;f||(f=a.getDnDSource(b));if(d=a.isDropAllowed(f,e,c.dropPos))a.toggle(e,!0),f&&(d={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:f,targetTree:a.getTreeName(),targetItem:e,isDropAllowed:d,dropPos:c.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(d)&&(a.drop(c),h.$$phase||h.$apply()))}}g.clearData();b.stopPropagation()});b.bind("dragenter",function(b){b.preventDefault();var c=angular.element(this),d=a.getItemFromChildElem(c);if(d&&(a.hoverItem=d,a.refresh(),a.options.autoExpand))var e=l(function(){I||(I=l(function(){I&&a.toggle(d,!0)},750));l.cancel(e)},1);c=g.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragEnter(c);b.stopPropagation()});b.bind("dragleave",function(b){b.preventDefault();a.hoverItem=null;var c=angular.element(this);a.getItemFromChildElem(c)&&a.refresh();I&&(l.cancel(I),I=null);c=g.getData();c.source||(c.source=a.getDnDSource(b));c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragItem:c.source,targetTree:a.getTreeName(),targetItem:c.target,mousePos:a.getMousePos(b)};a.callDragLeave(c);b.stopPropagation()});b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromChildElem(this);if(c){var d="dblclick"==a.options.editorSettings.activate;d&&U(b,angular.element(this),0);0==a.callItemDblClick(c,a.getMousePos(b))||d||a.toggle(c)}}b.stopPropagation()});b.bind("mouseenter",function(b){var c=a.getItemFromChildElem(this);c&&(angular.element(this),a.hoverItem=c,a.refresh(),a.callItemHover(c),a.options.hoverSelection&&(N=l(function(){N&&a.itemSelection(c)},500)))});b.bind("mouseleave",function(b){a.hoverItem=null;a.getItemFromChildElem(this)&&a.refresh();N&&(l.cancel(N),N=null)});var e=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),e=B+f-2,e=e<a.currentList.length-1?e:a.currentList.length-1;d===e&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);var r=a.getNextItem(d);if(r){a.itemSelection(r);h.$apply();var g=l(function(){a.updateFocus(r);l.cancel(g)},focusDelayTime)}},ta=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),e=B;d===(0<e?e:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);var f=a.getPrevItem(a.getItemCurrentIndex(c));if(f){a.itemSelection(f);h.$apply();var r=l(function(){a.updateFocus(f);l.cancel(r)},focusDelayTime)}};b.bind("keydown",function(c){var d=a.getItemFromChildElem(this);if(d){a.callKeyDown(c,d);var r=0;switch(c.keyCode){case 9:r=a.currentList.length;0<r&&(c.shiftKey?k.isEqual(d[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||ta(c,d):k.isEqual(d[a.options.dataFields.id],a.currentList[r-1][a.options.dataFields.id])||e(c,d));break;case 13:U(c,b,0);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 33:c.preventDefault();d=a.getItemCurrentIndex(d);c=d-f;c=0<c?c:0;if(c!==d){var r=1,g=a.getPrevItem(c+1);if(g){a.scrollTo(g);a.itemSelection(g);h.$apply();var S=l(function(){a.updateFocus(g);l.cancel(S)},r)}}break;case 34:c.preventDefault();d=a.getItemCurrentIndex(d);c=d+f;c=c<a.currentList.length-1?c:a.currentList.length-1;c!==d&&(r=1,g=a.getNextItem(c-1))&&(a.scrollTo(g,"bottom"),a.itemSelection(g),h.$apply(),S=l(function(){a.updateFocus(g);l.cancel(S)},r));break;case 35:c.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:E.y});var n=a.getLastItem();n&&(a.itemSelection(n),S=l(function(){a.updateFocus(n);l.cancel(S)},1));break;case 36:c.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var m=a.getFirstItem();m&&(a.itemSelection(m),S=l(function(){a.updateFocus(m);l.cancel(S)},1));break;case 37:c.preventDefault();d[a.options.dataFields.items]&&0<d[a.options.dataFields.items].length&&(a.toggle(d,!1),a.updateFocus(d));break;case 32:c.preventDefault();a.itemSelection(d,d.selected);h.$apply();break;case 38:ta(c,d);break;case 39:c.preventDefault();d[a.options.dataFields.items]&&0<d[a.options.dataFields.items].length&&(a.toggle(d,!0),a.updateFocus(d));break;case 40:e(c,d);break;default:(c.ctrlKey||c.metaKey)&&a.updateSelectionStatus("ctrl"),c.shiftKey&&a.updateSelectionStatus("shift")}}});b.bind("keyup",function(b){switch(b.keyCode){case 16:a.multiSelection(!1);a.shiftKeyStatus(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||(a.multiSelection(!1),a.shiftKeyStatus(!1))}var c=a.getItemFromChildElem(this);a.callKeyUp(b,c)});b.bind("keypress",function(b){var c=a.getItemFromChildElem(this);a.callKeyPress(b,c)});b.bind("click",function(b){if(1===b.which){var c=a.getItemFromChildElem(this);c&&a.callItemClick(c,a.getMousePos(b))}b.stopPropagation()});b.bind("mousedown",function(b){a.mouseButtonStatus(!0);var c=a.getItemFromChildElem(this);if(c)switch(a.itemSelection(c),b.which){case 1:a.changeCheckValue(c);"click"==a.options.editorSettings.activate&&U(b,angular.element(this));break;case 3:a.callItemRightClick(c,a.getMousePos(b))}b.stopPropagation()});b.bind("mouseup",function(b){a.mouseButtonStatus(!1);var c=a.getItemFromChildElem(this);c&&a.updateSelection(c);1===b.which&&F&&(l.cancel(F),F=null)});b.bind("focus",function(b){var c=a.getItemFromChildElem(this);c&&a.callGotFocus(b,c)});b.bind("blur",function(b){var c=a.getItemFromChildElem(this);c&&a.callLostFocus(b,c)})}},U=function(b,c,d){a.options.labelEdit&&(void 0===d&&(d=500),F=l(function(){if(F)var a=l(function(){L(b,c,!0);l.cancel(a)},d);l.cancel(F)},d/3))},K=null,L=function(b,c,d){var e=a.getItemFromChildElem(c);if(e)if(d){if(d="",0!=a.callBeforeEdit(e)){K=e;a.labelEditStatus(!0);n.append(q);b=c[0].offsetHeight-4;d=c[0].offsetTop;var f=a.scrollPos.x+c[0].offsetLeft,g=n[0].clientWidth-c[0].offsetLeft-6;u&&(g-=16);a.updateEditBox({top:d,left:f,width:g,height:b});q[0].value=e[a.options.dataFields.text];q.bind("keydown",function(b){switch(b.keyCode){case 13:e[a.options.dataFields.text]=q[0].value?q[0].value:"null";h.$apply();L(b,c,!1);a.updateLayout();a.updateFocus(e);break;case 27:L(b,c,!1)}b.stopPropagation()});q.bind("focus",function(b){var c=angular.element(this);a.callGotFocus(b,K,!0,c[0].value)});q.bind("blur",function(a){L(a)});q.bind("mousedown",function(a){a.stopPropagation()});var k=l(function(){q[0].focus();q[0].select();l.cancel(k)},10)}}else d=q[0].value,a.labelEditStatus(!1),q.unbind("blur focus keydown mousedown"),q.remove(),a.updateView(),a.updateFocus(e),a.callAfterEdit(e),a.callLostFocus(b,e,!0,d),K=null;else d=q[0].value,a.labelEditStatus(!1),q.unbind("blur focus keydown mousedown"),q.remove(),a.callAfterEdit(),a.updateView(),a.callLostFocus(b,K,!0,d),K=null},B=0,C=null,b=100,c=0,m=0,f=0,H=0,M=0,fa=!1,Z=!1,aa=9,ba=9,ja=0,P=0,T=0,ca=1,ka=0,da=0,Q=0,Y=0,la=1,z=null,A=null,x=!1,u=!1;this.scrollMousePos=null;var E={x:0,y:0},da=0;a.updateViewSize=function(){var e=l(function(){m=0;u=x=!1;if(a.longestItem&&0<a.currentList.length){var f=a.getItemCurrentIndex(a.longestItem),f=angular.element(d(ua(f,!0))(h));n.append(f);m=f[0].offsetWidth;var g=n[0].offsetWidth-6;u&&v&&(g-=v[0].offsetWidth);m>g&&(t.unbind("mousedown"),n.append(t),t.bind("mousedown",function(b){b=k.getClientMousePos(b,this);var c=Math.floor(n[0].clientWidth);z&&(b.x<z[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>z[0].offsetLeft+z[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}),z=angular.element(t.children().eq(0)),x=!0,z.bind("mousedown",function(b){1===b.which&&(p.scrollMousePos=a.getMousePos(b),fa=!0);b.stopPropagation()}));g=k.getMargin(f[0]);c=f[0].offsetHeight+(g.top+g.bottom);g=n[0].offsetHeight-6;x&&t&&(g-=t[0].offsetHeight);b=Math.floor(g/c)+1;u=!1;b<a.currentList.length+1&&(v.unbind("mousedown"),n.append(v),v.bind("mousedown",function(b){b=k.getClientMousePos(b,this);var c=Math.floor(n[0].clientHeight);A&&(b.y<A[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),ia(!1,c)):b.y>A[0].offsetTop+A[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),ia(!0,c)))}),A=angular.element(v.children().eq(0)),u=!0,A.bind("mousedown",function(b){1===b.which&&(p.scrollMousePos=a.getMousePos(b),Z=!0);b.stopPropagation()}));f.remove()}x||(t.unbind("mousedown"),t.remove());u||(v.unbind("mousedown"),v.remove());x&&u?n.append(J):J.remove();l.cancel(e);!x&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!u&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};var qa=function(){var d=l(function(){H=n[0].offsetWidth-6;M=n[0].offsetHeight-6;M=x?M-t[0].offsetHeight:M-4;H=u?H-v[0].offsetWidth:H-4;H<m?y.css("width",m+"px"):y.css("width",H+"px");y.css("height",M+"px");x&&(t.css("bottom","0px"),u||(H+=3),t.css("width",H+1+"px"));u&&(v.css("top","0px"),x||(M+=3),v.css("height",M+1+"px"));x&&u&&J.css("bottom","0px");!1!==a.options.rtl?(y.css("left","auto"),y.css("right","-"+(a.scrollPos.x-2).toString()+"px"),x&&(t.css("left","auto"),t.css("right","0px")),u&&(v.css("left","0px"),v.css("right","auto")),x&&u&&(J.css("left","0px"),J.css("right","auto"))):(y.css("left","-"+(a.scrollPos.x-2).toString()+"px"),y.css("right","auto"),x&&(t.css("left","0px"),t.css("right","auto")),u&&(v.css("left","auto"),v.css("right","0px")),x&&u&&(J.css("left","auto"),J.css("right","0px")));var e=l(function(){x&&H<m&&(ja=0,P=2,T=t[0].clientWidth-4,T>P&&(ja=T-P),aa=Math.floor(ja*(H-4)/m),9>aa&&(aa=9),z.css("width",aa+"px"),E.x=m-H,0>E.x&&(E.x=0),ca=E.x/(ja-aa-2));var d=a.currentList.length+1;u&&0<a.currentList.length&&b<d&&(Q=2,Y=v[0].clientHeight-4,ka=0,Y>Q&&(ka=Y-Q),ba=Math.floor(ka*b/d),9>ba&&(ba=9),A.css("height",ba+"px"),la=(d-b)/(ka-ba-2),E.y=(d-b)*c,0>E.y&&(E.y=0),0==B?A.css("top",Q+"px"):B+b-1==a.currentList.length&&A.css("top",Y-A[0].offsetHeight+"px"));l.cancel(e)},1);l.cancel(d)},5)};a.updateCurrentLayout=function(){a.updateLayout()};a.updateLayout=function(d){a.allowUpdate&&(n.removeClass("iui-treeview-block-rtl"),a.options.rtl&&n.addClass("iui-treeview-block-rtl"),y.removeClass("iui-treeview-block-shift-left iui-treeview-block-rtl"),y.addClass(ga()),a.allowEvents=!1,c=m=0,b=100,b=Math.floor(n[0].clientHeight/20),a.updateCurrentList(),va(),a.updateView(d),a.updateView(d),l(function(){a.allowEvents=!0;a.updateViewSize();a.updateViewSize();qa()},1))};h.onCheckValueChanging=function(b,c){return a.callCheckValueChanging(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};h.onCheckValueChanged=function(b,c){a.callCheckValueChanged(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked);a.fillCheckList(a.currentList[c])};var ua=function(b,c){var d=a.currentList[b],e=a.defaultStyle.item.general.normal,f=a.getCurrentItemStyle(d,a.getObjState(d)),d='<li class="'+e;f!=e&&(d+=" "+f);d+='" ';d=c?d+('style="position:absolute;top:-9999px;padding-left:'+a.indentList[b]+'px"'):d+('data-index="'+b+'"');!c&&0<a.indentList[b]&&(d=a.options.rtl?d+(' style="padding-right:'+a.indentList[b]+'px"'):d+(' style="padding-left:'+a.indentList[b]+'px"'));d+=">";!1!==a.options.showStatusIcons&&(e="iui-treeview-status-icon "+a.currentList[b].statusIcon,d+='<span class="'+e+'" data-element="statusicon"></span>');var e=a.currentList[b],f="",g=a.defaultStyle.item.expandBox.general;a.options.controlStyle.item.expandBox.general!=g&&(g+=" "+a.options.controlStyle.item.expandBox.general);var h=a.getCurrentItemStyle(e),h=a.getExpandBoxStyle(h.expandBox);if(a.isThereChildItems||e&&e[a.options.dataFields.hasChildren])f=g;e&&(e[a.options.dataFields.hasChildren]||e[a.options.dataFields.items]&&0<e[a.options.dataFields.items].length&&a.isThereVisibleChildren(e))&&(a.options.loadItem&&k.isEqual(e[a.options.dataFields.id],a.options.loadItem[a.options.dataFields.id])?f+=" "+h.animated:(f=e[a.options.dataFields.hasChildren]&&void 0===e[a.options.dataFields.expanded]?f+(" "+h.expanded):0!=e[a.options.dataFields.expanded]?f+(" "+h.collapsed):f+(" "+h.expanded),!0===a.options.rtl&&(f+="-rtl"),a.isItemEnabled(e)||(f+="-disabled")));d+='<span class="'+f+'" data-element="expandbox"></span>';1==a.options.showCheckBoxes&&(d+='<iui-checkbox name="cb-'+k.getUniqueId(4)+'"',e=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,f=a.currentList[b],e&&void 0==f[a.options.dataFields.checkState]?f[a.options.dataFields.checkState]="unchecked":void 0==f[a.options.dataFields.checked]&&(f[a.options.dataFields.checked]=!1),e?(d+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',d=d+(' checkstate-changing="onCheckValueChanging(e, '+b+')"')+(' checkstate-changed="onCheckValueChanged(e, '+b+')"'),d+=' three-state="true"'):(d+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',d+=' checked-changing="onCheckValueChanging(e, '+b+')"',d+=' checked-changed="onCheckValueChanged(e, '+b+')"'),a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&C.checkBoxStyle?d+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&C.checkBoxStyle&&(d+=' control-style="checkBoxStyle"'),a.isItemEnabled(a.currentList[b])||(d+=' enabled="false"'),d+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<ma&&(d+="width: "+ma+"px;"),d+='"></iui-checkbox>');!1!==a.options.showIcons&&(a.currentList[b].icon||a.options.itemIcon)&&(e=a.currentList[b],f="",e[a.options.dataFields.icon]?f=e[a.options.dataFields.icon]:a.options.itemIcon&&(f=a.options.itemIcon),d+='<span class="'+f+'" data-element="icon"></span>');e=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=e&&(e+=" "+a.options.controlStyle.item.content.normal);f=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(d+='<div class="'+e+" "+f+'" data-element="content">',d+=a.currentList[b][a.options.dataFields.content],d+="</div>"):(d+='<span class="'+e+" "+f+'" data-element="content"',!c&&a.currentList[b].contextMenu&&(d+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),d+=">",d=c?d+a.currentList[b][a.options.dataFields.text]:d+("{{data["+b+"]."+a.options.dataFields.text+"}}"),d+="</span>");return d+="</li>"},ma=0,va=function(){if(1==a.options.showCheckBoxes){var b=angular.element(d('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(h));n.append(b);ma=0;b&&0<b.children().length&&(ma=parseInt(getComputedStyle(angular.element(b.children().eq(0))[0]).width,10));b.remove()}};a.updateView=function(e){var g=l(function(){fa||Z||qa();V();y.empty();C&&C.$destroy();ra(!1);a.currentList.length>=b&&B+b-1>a.currentList.length&&(B=a.currentList.length-b+1);if(B<a.currentList.length){C=h.$new();C.data=a.currentList;C.checkBoxStyle=a.options.checkBoxSettings.style;!C.checkBoxStyle&&a.options.controlStyle.item.checkBox&&(C.checkBoxStyle=a.options.controlStyle.item.checkBox);f=0;var e="";firstItemElem=e=null;for(var w=k.getMargin(),m=0,p=B;p<B+b&&p<a.currentList.length;p++)e=ua(p),e=a.currentList[p].content?d(e)(h.$parent):d(e)(C),e=angular.element(e),y.append(e),w=k.getMargin(e[0]),m+=e[0].offsetHeight+(w.top+w.bottom),f++;if(0<f){p=null;e=y.find("li");if(0<e.length)for(var w=null,q=0;q<e.length;q++)w=angular.element(e[q]),(p=a.getItemFromElem(w))&&a.isItemEnabled(p)&&(ha(w),O(a.getElement(w,"expandbox")),W(a.getElement(w),a.getItemFromElem(w)));p=n[0].offsetHeight-6;x&&t&&(p-=t[0].offsetHeight);c=m/f;b=Math.floor(p/c)+1;qa()}sa();a.refresh()}l.cancel(g)},1)};a.refresh=function(c,d){if(c){var e=null;switch(c.type){case "item":if(e=a.getElemFromItem(c)){e.removeAttr("class");e.addClass(a.defaultStyle.item.general.normal);e.addClass(a.options.controlStyle.item.general.normal);var f=a.getCurrentItemStyle(c,a.getObjState(c));f!=a.options.controlStyle.item.general.normal&&e.addClass(f);if(e=a.getElement(e))e.removeAttr("class"),e.addClass(a.defaultStyle.item.content.normal),e.addClass(a.options.controlStyle.item.content.normal),f=a.getCurrentItemContentStyle(c,a.getObjState(c)),f!=a.options.controlStyle.item.content.normal&&e.addClass(f)}}}else for(f=B;f<B+b&&f<a.currentList.length;f++)a.refresh(a.currentList[f])};var na=!1,R=0,oa=null,pa=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return x;case "vertical":return u}return x&&u};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){if(b){0>b.x&&(b.x=0);b.x>E.x&&(b.x=E.x);0>b.y&&(b.y=0);b.y>E.y&&(b.y=E.y);a.scrollPos=b;da=Math.floor(a.scrollPos.y/(c*la));b=0;var d=Q+da;x&&z&&(b=!1!==a.options.rtl?Math.floor(a.scrollPos.x/ca)-(T-z[0].offsetWidth-P):Math.floor(a.scrollPos.x/ca)+P,z.css("left",b+"px"));u&&A&&A.css("top",d+"px");sa();ra();angular.isDefined(h.events)&&h.events.scrollPosChanged?h.events.scrollPosChanged({scrollPos:a.scrollPos}):h.scrollposChanged({e:{scrollPos:a.scrollPos}})}};var ia=function(b,c,d){na||(R=0,na=!0,oa=e(function(){var d=c,e=a.getScrollPos();d||(0===R&&(R=5),R+=5+la,pa+=.5,d=R+=Math.floor(pa));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&X()},d?d:100))},X=function(){na&&(oa&&(e.cancel(oa),oa=null),na=!1,R=0,pa=.5)};a.cancelScrollTimer=function(){X()};a.scrollTo=function(b,d){if(b){var e=a.getItemCurrentIndex(b);if(a.isIndexInRange(e)){var g=0,h=e;switch(d){case "center":g=Math.floor(f/2);h=e>g?e-g:0;break;case "bottom":g=f-2,h=e>g?e-g:0}var k=l(function(){a.setScrollPos({x:a.scrollPos.x,y:h*c});l.cancel(k)},1)}}};var sa=function(){if(y){var b=a.scrollPos.x;0>b&&(b=0);b>E.x&&(b=E.x);b=2-b;!1!==a.options.rtl?y.css("right",b+"px"):y.css("left",b+"px")}},ra=function(d){0==d&&0>=c||(newIndex=0<c?Math.floor(a.scrollPos.y/c):0,newIndex+b-1>a.currentList.length&&(newIndex=a.currentList.length-b+1),0>newIndex&&(newIndex=0),newIndex!==B&&(B=newIndex,0!=d&&a.updateView(!0)))};n.bind("scroll",function(a){n[0].scrollTop=0;n[0].scrollLeft=0});n.bind("mousewheel",function(b){b.preventDefault();a.hoverItem=null;var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)*c*-1});l(function(){var c=a.getMousePos(b),d=angular.element(D)[0].pageXOffset,e=angular.element(D)[0].pageYOffset;c.x-=d;c.y-=e;if(c=a.getItemAt(c.x,c.y))a.hoverItem=c,a.refresh()},1)});angular.element(D).bind("dragover",function(a){X()});angular.element(D).bind("mousemove",function(b){if(fa){if(1===b.which){z[0].getBoundingClientRect();b=a.getMousePos(b);p.scrollMousePos||(p.scrollMousePos=b);var d=z[0].offsetLeft+(b.x-p.scrollMousePos.x);d<P?d=P:d+z[0].offsetWidth>T&&(d=T-z[0].offsetWidth);z.css("left",d+"px");p.scrollMousePos=b;a.scrollPos.x=!1!==a.options.rtl?parseInt((T-z[0].offsetLeft-z[0].offsetWidth)*ca,10):parseInt((z[0].offsetLeft-P)*ca,10);sa()}}else Z&&1===b.which&&(A[0].getBoundingClientRect(),b=a.getMousePos(b),p.scrollMousePos||(p.scrollMousePos=b),d=A[0].offsetTop+(b.y-p.scrollMousePos.y),d<Q?d=Q:d+A[0].offsetHeight>Y&&(d=Y-A[0].offsetHeight),A.css("top",d+"px"),p.scrollMousePos=b,da=d-Q,a.scrollPos.y=Math.floor(da*la*c),ra())});angular.element(D).bind("mouseup",function(b){a.dropMark();Z&&a.updateView();X();p.scrollMousePos=null;Z=fa=!1});p=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(p.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=l(function(){p.trActive||(p.trCount=0,p.trActive=!0,p.trId=e(function(){p.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(e.clear(this.trId),this.trId=null);this.trlTime&&(l.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};n.append(this.$tw);this.s1t(this.twp);angular.isDefined(h.options)?(a.options=h.options,a.updateData()):(0==h.allowAnimation&&(a.options.allowAnimation=h.allowAnimation),1==h.allowDrag&&(a.options.allowDrag=h.allowDrag),0==h.allowDrop&&(a.options.allowDrop=h.allowDrop),angular.isDefined(h.animationSpeed)&&200!==h.animationSpeed&&(a.options.animationSpeed=h.animationSpeed),0==h.allowFocus&&(a.options.allowFocus=h.allowFocus),1==h.autoCheck&&(a.options.autoCheck=h.autoCheck),0==h.autoExpand&&(a.options.autoExpand=h.autoExpand),angular.isDefined(h.checkboxSettings)&&a.updateCheckBoxSettings(h.checkboxSettings),angular.isDefined(h.controlStyle)&&a.updateControlStyle(h.controlStyle),angular.isDefined(h.editorSettings)&&a.updateEditorSettings(h.editorSettings),angular.isDefined(h.fields)&&(a.updateDataFields(h.fields),a.updateData()),!0===h.hoverSelection&&(a.options.hoverSelection=h.hoverSelection),angular.isDefined(h.itemIcon)&&(a.options.itemIcon=h.itemIcon),angular.isDefined(h.labelEdit)&&(a.options.labelEdit=h.labelEdit),!0===h.rtl&&(a.options.rtl=h.rtl),angular.isDefined(h.selectedIndex)&&(a.options.selectedIndex=h.selectedIndex),angular.isDefined(h.selectedItem)&&(a.options.selectedItem=h.selectedItem),angular.isDefined(h.selectionMode)&&(a.options.selectionMode=h.selectionMode),!0===h.showCheckBoxes&&(a.options.showCheckBoxes=h.showCheckBoxes),!1===h.showIcons&&(a.options.showIcons=h.showIcons),!0===h.showStatusIcons&&(a.options.showStatusIcons=h.showStatusIcons),angular.isDefined(h.sorting)&&(a.options.sorting=h.sorting));a.updateLayout()}}}]);